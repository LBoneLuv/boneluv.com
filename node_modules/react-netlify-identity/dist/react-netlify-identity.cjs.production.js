"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("react")),n=e(require("gotrue-js")),r=/(confirmation|invite|recovery|email_change)_token=([^&]+)/,o=/error=access_denied&error_description=403/,i=/access_token=/,u=/confirmation_token=/,c={autoconfirm:!1,disable_signup:!1,external:{bitbucket:!1,email:!0,facebook:!1,github:!1,gitlab:!1,google:!1}},a=l(),s=a[1],f=a[0];function d(e,a,s){void 0===a&&(a=function(){}),void 0===s&&(s=!0);var f=t.useMemo(function(){return new n({APIUrl:e+"/.netlify/identity",setCookie:!0})},[e]),d=t.useState(f.currentUser()||void 0),l=d[0],h=d[1],v=function(e){return h(e),a(e),e};t.useEffect(function(){s&&function(e,t,n){void 0===n&&(n=!0);var c=(document.location.hash||"").replace(/^#\/?/,"");if(c){c.match(r)&&(document.location.hash=""),c.match(o)&&(document.location.hash="");var a={};c.split("&").forEach(function(e){var t=e.split("=");a[t[0]]=t[1]}),c.match(i)&&(document&&a.access_token&&(document.cookie="nf_jwt="+a.access_token),document.location.hash="",e.createUser(a,n).then(t).catch(console.error)),c.match(u)&&(document.location.hash="",e.confirm(a.confirmation_token).then(t).catch(console.error))}}(f,v)},[]);var g=f.settings.bind(f),p=t.useState(c),m=p[0],w=p[1];t.useEffect(function(){g().then(function(e){return w(e)})},[]);var k=function(e){return function(t,n){if(void 0===n&&(n={}),!l||!l.token||!l.token.access_token)throw new Error("no user token found");var r=Object.assign({headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l.token.access_token}},{method:e},n);return fetch(t,r).then(function(e){return"application/json"===r.headers["Content-Type"]?e.json():e})}},E={get:k("GET"),post:k("POST"),put:k("PUT"),delete:k("DELETE")};return{user:l,setUser:h,isConfirmedUser:!(!l||!l.confirmed_at),isLoggedIn:!!l,signupUser:function(e,t,n){return f.signup(e,t,n).then(v)},loginUser:function(e,t,n){return void 0===n&&(n=!0),f.login(e,t,n).then(v)},logoutUser:function(){if(!l)throw new Error("No current user found - are you logged in?");return l.logout().then(function(){return v(void 0)})},requestPasswordRecovery:function(e){return f.requestPasswordRecovery(e)},recoverAccount:function(e,t){return f.recover(e,t)},updateUser:function(e){if(null==l)throw new Error("No current user found - are you logged in?");return l.update(e).then(v)},getFreshJWT:function(){if(!l)throw new Error("No current user found - are you logged in?");return l.jwt()},authedFetch:E,_goTrueInstance:f,_url:e,loginProvider:function(e){var t=f.loginExternalUrl(e);window.location.href=t},acceptInviteExternalUrl:function(e,t){return f.acceptInviteExternalUrl(e,t)},settings:m}}function l(){var e=t.createContext(void 0);return[function(){var n=t.useContext(e);if(!n)throw new Error("useCtx must be inside a Provider with a value");return n},e.Provider]}exports.IdentityContextProvider=function(e){var n=e.url,r=e.children,o=e.onAuthChange,i=void 0===o?function(){}:o;if(!n||!/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(n))throw new Error("invalid netlify instance URL: "+n+". Please check the docs for proper usage or file an issue.");var u=d(n,i);return t.createElement(s,{value:u},r)},exports.useIdentityContext=f,exports.useNetlifyIdentity=d;
//# sourceMappingURL=react-netlify-identity.cjs.production.js.map
